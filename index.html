<!DOCTYPE html>
<html>
<head>
    <title>Deadshot Clone - Minimal Client</title>
    <style>
        body { margin: 0; background-color: #222; color: white; font-family: sans-serif; }
        #log { border: 1px solid #4CAF50; padding: 10px; margin: 10px; height: 200px; overflow-y: scroll; background-color: #333; }
        .player {
            position: absolute;
            width: 50px;
            height: 50px;
            background-color: red;
            border-radius: 50%;
            text-align: center;
            line-height: 50px;
            color: white;
            font-size: 10px;
            border: 2px solid white;
            transition: transform 0.1s linear; /* Sima mozg√°s√©rt */
        }
    </style>
</head>
<body>

    <h1>Socket.IO Multiplayer Teszt</h1>
    <div id="log">Kapcsol√≥d√°si napl√≥ (Log):</div>
    
    <div id="myPlayer" class="player">YOU</div>

    <script src="/socket.io/socket.io.js"></script> 
    
    <script>
        // Kliens oldali socket kapcsolat l√©trehoz√°sa
        const socket = io();
        const log = document.getElementById('log');
        const myPlayer = document.getElementById('myPlayer');
        const players = {}; // J√°t√©kosok t√°rol√°sa: { socketId: DOMElement }

        // Mozg√°s √°llapota
        let position = { x: 50, y: 50 };
        myPlayer.style.left = position.x + 'px';
        myPlayer.style.top = position.y + 'px';

        // -------------------------
        // 1. Kapcsol√≥d√°si esem√©nyek
        // -------------------------

        socket.on('connect', () => {
            addLog(`üü¢ Connected to server! ID: ${socket.id}`);
            // A saj√°t j√°t√©kosunk hozz√°ad√°sa a "players" list√°hoz
            players[socket.id] = myPlayer;
        });

        socket.on('welcome', (data) => {
            addLog(`Server message: ${data.message}`);
        });

        socket.on('playerDisconnected', (data) => {
            addLog(`üî¥ Player disconnected: ${data.id}`);
            const otherPlayer = document.getElementById(data.id);
            if (otherPlayer) {
                otherPlayer.remove(); // Elt√°vol√≠tja a DOM-b√≥l
                delete players[data.id]; // Elt√°vol√≠tja a list√°b√≥l
            }
        });

        // ---------------------------------
        // 2. J√°t√©k logik√°j√°nak kezel√©se (mozg√°s)
        // ---------------------------------
        
        // Esem√©ny fogad√°sa m√°s j√°t√©kosokt√≥l
        socket.on('movePlayer', (data) => {
            // Ha a j√°t√©kos m√©g nem l√©tezik, l√©trehozzuk
            if (!players[data.id]) {
                createOtherPlayer(data.id);
            }
            // Ekkor m√°r biztosan l√©tezik
            const otherPlayer = players[data.id];
            
            // A mozg√°s alkalmaz√°sa (CSS manipul√°ci√≥val)
            otherPlayer.style.left = data.x + 'px';
            otherPlayer.style.top = data.y + 'px';
            
            // Logoljuk csak az els≈ë 5 mozg√°st a zs√∫folts√°g elker√ºl√©se √©rdek√©ben
            if (Object.keys(players).length < 5) {
                // addLog(`Player ${data.id.substring(0, 4)} moved to (${data.x}, ${data.y})`);
            }
        });

        // -------------------------
        // 3. J√°t√©kos Mozg√°s√°nak Kezel√©se
        // -------------------------

        // Billenty≈±zetkezel√©s a saj√°t j√°t√©kosunk mozgat√°s√°hoz
        document.addEventListener('keydown', (e) => {
            const speed = 10;
            let moved = false;

            if (e.key === 'ArrowUp' || e.key === 'w') {
                position.y -= speed;
                moved = true;
            } else if (e.key === 'ArrowDown' || e.key === 's') {
                position.y += speed;
                moved = true;
            } else if (e.key === 'ArrowLeft' || e.key === 'a') {
                position.x -= speed;
                moved = true;
            } else if (e.key === 'ArrowRight' || e.key === 'd') {
                position.x += speed;
                moved = true;
            }

            if (moved) {
                // Friss√≠tj√ºk a saj√°t vizu√°lis poz√≠ci√≥nkat
                myPlayer.style.left = position.x + 'px';
                myPlayer.style.top = position.y + 'px';
                
                // **A KULCSFONTOSS√ÅG√ö R√âSZ:** Elk√ºldj√ºk a mozg√°si adatot a szervernek
                socket.emit('playerMovement', { x: position.x, y: position.y });
            }
        });


        // -------------------------
        // 4. Seg√©df√ºggv√©nyek
        // -------------------------

        // Log √ºzenet hozz√°ad√°sa
        function addLog(message) {
            const item = document.createElement('div');
            item.textContent = message;
            log.appendChild(item);
            log.scrollTop = log.scrollHeight;
        }
        
        // M√°s j√°t√©kos DOM elem√©nek l√©trehoz√°sa
        function createOtherPlayer(id) {
            const playerElement = document.createElement('div');
            playerElement.className = 'player';
            playerElement.id = id;
            playerElement.textContent = id.substring(0, 4); // ID r√∂vid√≠tve
            playerElement.style.backgroundColor = `hsl(${Math.random() * 360}, 70%, 50%)`; // V√©letlen sz√≠n
            document.body.appendChild(playerElement);
            players[id] = playerElement;
            addLog(`New player joined: ${id}`);
        }

    </script>
</body>
</html>
